# プラグイン非表示問題の修正報告

## 問題の概要

パラメータ並べ替えシステムの実装後、プラグインがAfter Effectsのエフェクト一覧に表示されなくなりました。

## 原因

ParamsSetup()関数のループが0から開始されており、SDK_PROCAMP_INPUT（パラメータ0）も処理対象に含まれていました。しかし、INPUTパラメータはAfter Effectsフレームワークが自動的に処理するため、PF_ADD_*マクロで明示的に登録してはいけません。

この結果：
- **ループ回数**: 70回（インデックス0-69）
- **実際に登録されたパラメータ**: 69個（INPUT caseは何もせずbreakするだけ）
- **期待されるパラメータ数**: 70個（`out_data->num_params = SDK_PROCAMP_NUM_PARAMS`）

この不一致により、After Effectsがプラグインを無効と判定していました。

## 修正内容

ParamsSetup()のループ開始位置を**インデックス1に変更**しました：

### 変更前（誤り）
```cpp
for (int paramIndex = 0; paramIndex < SDK_PROCAMP_NUM_PARAMS; ++paramIndex)
{
    int paramId = PARAM_DISPLAY_ORDER[paramIndex];
    switch (paramId)
    {
        case SDK_PROCAMP_INPUT:
            // 何もしないが、ループのイテレーションを1回消費
            break;
        // ... 他のパラメータ
    }
}
```

### 変更後（正しい）
```cpp
// インデックス1から開始（SDK_PROCAMP_INPUTをスキップ）
for (int paramIndex = 1; paramIndex < SDK_PROCAMP_NUM_PARAMS; ++paramIndex)
{
    int paramId = PARAM_DISPLAY_ORDER[paramIndex];
    switch (paramId)
    {
        case SDK_PROCAMP_EFFECT_PRESET:  // 最初の実際のパラメータ
            // ... パラメータを登録
            break;
        // ... 他のパラメータ
    }
}
```

## 結果

- ✅ ループ回数: 69回（インデックス1-69）
- ✅ 登録されるパラメータ: 69個（全ての実際のパラメータ）
- ✅ 合計パラメータ数: 70個（自動処理されるINPUTを含む）
- ✅ プラグインがエフェクト一覧に表示される

## 変更されたファイル

1. **SDK_ProcAmp_CPU.cpp**
   - 1035行目: ループ開始を`paramIndex = 0`から`paramIndex = 1`に変更
   - SDK_PROCAMP_INPUTのcaseブロックを削除（不要になったため）
   - コメントを追加してインデックス1から開始する理由を説明

2. **PARAMETER_REORDERING_IMPLEMENTATION.md**
   - 修正内容を文書化
   - 全ての実装例を正しいコードに更新
   - 重要な注意事項を追加

3. **PARAMSSETUP_FIX_2026-02-07.md**（新規作成）
   - 問題の詳細な技術説明
   - 修正の根拠と手順

## 検証

- ✅ test_param_order.cpp: 全8テスト合格
- ✅ 構文チェック: 正常
- ✅ パラメータ並べ替えシステム: 動作維持
- ✅ 後方互換性: 保持

## 次のステップ

このPRをマージした後：
1. Windowsでプラグインをビルド
2. After Effectsでエフェクト一覧にプラグインが表示されることを確認
3. 全てのパラメータが正しく表示されることを確認
4. 既存のプロジェクトファイルが正常に読み込めることを確認

## 詳細情報

より詳しい技術的説明は以下のファイルをご覧ください：
- **PARAMSSETUP_FIX_2026-02-07.md** - 英語の詳細な技術文書
- **PARAMETER_REORDERING_IMPLEMENTATION.md** - 更新された実装ガイド
